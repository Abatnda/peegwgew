-- AutoJoiner –¥–ª—è Discord (User Token)
-- –ù–ê–°–¢–†–û–ô–ö–ò - –ó–ê–ü–û–õ–ù–ò–¢–ï –≠–¢–û!
local DISCORD_TOKEN = "MTM4OTczMDgzMjEyNTY2MTI1NA.GmfKfX.YwFmxwcrjypRCTmPTusg4d8f3apeGrcqMKO0ew"    -- –¢–û–ö–ï–ù –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø Discord
local CHANNEL_ID = "1423378814020620298"          -- ID –∫–∞–Ω–∞–ª–∞ —Å –ª–æ–≥–∞–º–∏
local AUTO_JOIN = true

local AutoJoiner = {
    DiscordToken = DISCORD_TOKEN,
    ChannelId = CHANNEL_ID,
    Enabled = AUTO_JOIN,
    Cooldown = 2,
    LastJobId = "",
    IsMonitoring = false
}

-- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Discord –∫–∞–Ω–∞–ª–∞
function AutoJoiner:GetDiscordMessages()
    if not self.DiscordToken or self.DiscordToken == "YOUR_USER_TOKEN_HERE" then
        error("‚ùå –£–∫–∞–∂–∏—Ç–µ USER TOKEN Discord –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö!")
        return
    end
    
    local success, messages = pcall(function()
        local httpService = game:GetService("HttpService")
        local url = "https://discord.com/api/v10/channels/" .. self.ChannelId .. "/messages?limit=10"
        
        local headers = {
            ["Authorization"] = self.DiscordToken,  -- User token –Ω–∞–ø—Ä—è–º—É—é
            ["Content-Type"] = "application/json",
            ["User-Agent"] = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        }
        
        local response = httpService:GetAsync(url, true, headers)
        local data = httpService:JSONDecode(response)
        
        return data
    end)
    
    if success and messages then
        for i, message in ipairs(messages) do
            self:CheckForJobId(message.content)
        end
        return true
    else
        print("[AutoJoiner] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π: " .. tostring(messages))
        return false
    end
end

-- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Discord –∫–∞–Ω–∞–ª–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
function AutoJoiner:StartDiscordMonitor()
    if self.IsMonitoring then return end
    
    self.IsMonitoring = true
    print("[AutoJoiner] üì° –ù–∞—á–∏–Ω–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Discord –∫–∞–Ω–∞–ª–∞...")
    
    spawn(function()
        local lastMessageId = ""
        
        while self.IsMonitoring do
            local success = pcall(function()
                local httpService = game:GetService("HttpService")
                local url = "https://discord.com/api/v10/channels/" .. self.ChannelId .. "/messages?limit=1"
                
                local headers = {
                    ["Authorization"] = self.DiscordToken,
                    ["Content-Type"] = "application/json",
                    ["User-Agent"] = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
                }
                
                local response = httpService:GetAsync(url, true, headers)
                local data = httpService:JSONDecode(response)
                
                if data and #data > 0 then
                    local latestMessage = data[1]
                    
                    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    if latestMessage.id ~= lastMessageId then
                        lastMessageId = latestMessage.id
                        print("[AutoJoiner] üì® –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Discord")
                        self:CheckForJobId(latestMessage.content)
                    end
                end
            end)
            
            if not success then
                print("[AutoJoiner] ‚ö†Ô∏è –û—à–∏–±–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 10 —Å–µ–∫...")
            end
            
            wait(3) -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
        end
    end)
end

-- –ü–æ–∏—Å–∫ JobId –≤ —Ç–µ–∫—Å—Ç–µ
function AutoJoiner:ExtractJobId(text)
    if not text then return nil end
    
    -- –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è UUID
    local pattern = "(%x%x%x%x%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%x%x%x%x%x%x%x%x)"
    local jobId = string.match(text, pattern)
    
    -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
    if not jobId then
        local patterns = {
            "üì°%s*(%x%x%x%x%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%x%x%x%x%x%x%x%x)",
            "üåê%s*(%x%x%x%x%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%x%x%x%x%x%x%x%x)",
            "Server%s*(%x%x%x%x%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%x%x%x%x%x%x%x%x)",
            "JobID:%s*(%x%x%x%x%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%x%x%x%x%x%x%x%x)",
            "`(%x%x%x%x%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%x%x%x%x%x%x%x%x)`"
        }
        
        for _, pat in ipairs(patterns) do
            jobId = string.match(text, pat)
            if jobId then break end
        end
    end
    
    return jobId
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ JobId
function AutoJoiner:CheckForJobId(text)
    local jobId = self:ExtractJobId(text)
    
    if jobId and jobId ~= self.LastJobId and self.Enabled then
        print("[AutoJoiner] üéØ –û–±–Ω–∞—Ä—É–∂–µ–Ω –Ω–æ–≤—ã–π JobId: " .. jobId)
        self.LastJobId = jobId
        self:JoinGame(jobId)
        return true
    end
    
    return false
end

-- –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∏–≥—Ä–µ
function AutoJoiner:JoinGame(jobId)
    print("[AutoJoiner] üöÄ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É: " .. jobId)
    
    local success, result = pcall(function()
        local TeleportService = game:GetService("TeleportService")
        local Players = game:GetService("Players")
        local LocalPlayer = Players.LocalPlayer
        
        if not LocalPlayer then
            error("–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω")
        end
        
        -- –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π placeId –∏–≥—Ä—ã
        local placeId = game.PlaceId
        
        print("[AutoJoiner] üìç –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –Ω–∞ PlaceId: " .. placeId)
        print("[AutoJoiner] üÜî JobId: " .. jobId)
        
        -- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è
        TeleportService:TeleportToPlaceInstance(placeId, jobId, LocalPlayer)
    end)
    
    if success then
        print("[AutoJoiner] ‚úÖ –£—Å–ø–µ—à–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è!")
    else
        print("[AutoJoiner] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: " .. tostring(result))
    end
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Discord
function AutoJoiner:TestConnection()
    print("[AutoJoiner] üîó –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Discord...")
    
    local success, result = pcall(function()
        local httpService = game:GetService("HttpService")
        local url = "https://discord.com/api/v10/users/@me"
        
        local headers = {
            ["Authorization"] = self.DiscordToken,
            ["Content-Type"] = "application/json"
        }
        
        local response = httpService:GetAsync(url, true, headers)
        local userData = httpService:JSONDecode(response)
        
        return userData
    end)
    
    if success and result.username then
        print("[AutoJoiner] ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " .. result.username)
        return true
    else
        print("[AutoJoiner] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞")
        return false
    end
end

-- –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
function AutoJoiner:Toggle()
    self.Enabled = not self.Enabled
    if self.Enabled then
        print("[AutoJoiner] ‚úÖ –ê–≤—Ç–æ-–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –í–ö–õ–Æ–ß–ï–ù–û")
    else
        print("[AutoJoiner] ‚ùå –ê–≤—Ç–æ-–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –í–´–ö–õ–Æ–ß–ï–ù–û")
    end
end

function AutoJoiner:Status()
    print("[AutoJoiner] üìä –°—Ç–∞—Ç—É—Å:")
    print("   –ê–≤—Ç–æ-–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: " .. (self.Enabled and "–í–ö–õ" or "–í–´–ö–õ"))
    print("   –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: " .. (self.IsMonitoring and "–ê–ö–¢–ò–í–ï–ù" or "–í–´–ö–õ"))
    print("   –ö–∞–Ω–∞–ª Discord: " .. self.ChannelId)
    print("   –ü–æ—Å–ª–µ–¥–Ω–∏–π JobId: " .. (self.LastJobId ~= "" and self.LastJobId or "–Ω–µ—Ç"))
end

function AutoJoiner:Stop()
    self.IsMonitoring = false
    self.Enabled = false
    print("[AutoJoiner] üõë –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
end

-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
spawn(function()
    wait(2)
    
    print("========================================")
    print("üéÆ Discord AutoJoiner –∑–∞–ø—É—â–µ–Ω!")
    print("üìù –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è USER TOKEN")
    print("========================================")
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    if AutoJoiner:TestConnection() then
        -- –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
        AutoJoiner:StartDiscordMonitor()
        
        -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        AutoJoiner:GetDiscordMessages()
    else
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Discord")
        print("üîß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ ID –∫–∞–Ω–∞–ª–∞")
    end
end)

-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
getgenv().AutoJoiner = AutoJoiner

print("‚ö° –ö–æ–º–∞–Ω–¥—ã:")
print("   AutoJoiner:Toggle() - –í–∫–ª/–í—ã–∫–ª –∞–≤—Ç–æ-–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ")
print("   AutoJoiner:Status() - –°—Ç–∞—Ç—É—Å")
print("   AutoJoiner:Stop() - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å")

return AutoJoiner
